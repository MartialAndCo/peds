# ğŸ“Š Sources de donnÃ©es des Agents SpÃ©cialisÃ©s

Ce document dÃ©taille prÃ©cisÃ©ment **d'oÃ¹** chaque agent spÃ©cialisÃ© rÃ©cupÃ¨re ses informations.

---

## ğŸ¯ Vue d'ensemble des Agents

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AGENT SWARM                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    DonnÃ©es: Message utilisateur + Historique  â”‚
â”‚  â”‚  INTENTION   â”‚    Source: ParamÃ¨tre d'entrÃ©e                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              PARALLEL AGENTS (Contexte)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ TIMING   â”‚ PERSONA  â”‚  STYLE   â”‚  PHASE   â”‚   MEMORY    â”‚   â”‚
â”‚  â”‚(toujours)â”‚(toujours)â”‚(toujours)â”‚(si besoin)â”‚(si besoin)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              CONDITIONAL AGENTS (SpÃ©cifiques)             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚   PAYMENT    â”‚    MEDIA     â”‚        VOICE               â”‚   â”‚
â”‚  â”‚ (si argent)  â”‚ (si photo)   â”‚   (si vocal/accusation)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Assemble tous les contextes                 â”‚
â”‚  â”‚   RESPONSE   â”‚    GÃ©nÃ¨re la rÃ©ponse finale                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ DÃ©tail par Agent

### 1ï¸âƒ£ AGENT "INTENTION" (`intention-node.ts`)

**RÃ´le:** DÃ©tecter ce que veut l'utilisateur

**Source des donnÃ©es:**
- **Input direct:** Message utilisateur (paramÃ¨tre `userMessage`)
- **Historique:** 10 derniers messages (paramÃ¨tre `history`)
- **Analyse:** Appel LLM Ã  Venice pour classification

**Output:**
```typescript
{
  intention: 'paiement' | 'photo' | 'vocal' | 'personnel' | 'general',
  besoinMemoire: boolean,    // Besoin d'infos sur le contact?
  besoinTiming: boolean,     // Besoin de l'heure/activitÃ©?
  besoinPhase: boolean,      // Besoin de l'Ã©tat relation?
  confiance: number          // 0.0 - 1.0
}
```

---

### 2ï¸âƒ£ AGENT "TIMING" (`timing-node.ts`)

**RÃ´le:** Savoir quelle heure il est et ce que fait l'agent

**Source des donnÃ©es:**
```typescript
// 1. AgentProfile (DB) - ligne 8-12
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { timezone: true, locale: true }
})

// 2. personaSchedule (service existant) - ligne 16
const timingContext = personaSchedule.getContextPrompt(
  timezone,      // Ex: "Europe/Paris"
  undefined,     // Date actuelle
  locale         // Ex: "fr-FR"
)
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- Timezone de l'agent (`AgentProfile.timezone`)
- Locale (`AgentProfile.locale`)
- Heure actuelle calculÃ©e
- ActivitÃ© en cours (Ã©cole, dodo, etc.)
- Contraintes temporelles

**Exemple de output:**
```
[CONTEXTE VIE ACTUEL - Mercredi 14:30]:
âš ï¸ ACTION EN COURS : Tu es en cours de maths.
URGENT : Tu DOIS rÃ©pondre en prenant compte de ce contexte.
```

---

### 3ï¸âƒ£ AGENT "PERSONA" (`persona-node.ts`)

**RÃ´le:** Maintenir l'identitÃ© de l'agent (AnaÃ¯s/Lena)

**Source des donnÃ©es:**
```typescript
// AgentProfile (DB) - ligne 8-11
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { 
    identityTemplate: true,  // "Tu es AnaÃ¯s, 15 ans..."
    contextTemplate: true,   // "Tu habites en banlieue..."
    missionTemplate: true    // "Ton objectif est..."
  }
})
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- `identityTemplate`: Qui est l'agent (nom, Ã¢ge, caractÃ¨re)
- `contextTemplate**: Situation familiale, hobbies, vie
- `missionTemplate`: Objectif global

**Exemple de output:**
```
[QUI TU ES]:
Tu es AnaÃ¯s, 15 ans, lycÃ©enne en banlieue parisienne (94)...

[TA SITUATION]:
MÃ¨re cÃ©libataire, grand frÃ¨re Lucas (19 ans)...

[TA MISSION]:
Ton objectif est de crÃ©er de vraies connexions...
```

---

### 4ï¸âƒ£ AGENT "STYLE" (`style-node.ts`)

**RÃ´le:** DÃ©finir comment parler (ton, longueur, anti-rÃ©pÃ©tition)

**Source des donnÃ©es:**
```typescript
// 1. AgentProfile (DB) - ligne 10-13
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { styleRules: true, locale: true }
})

// 2. Message history (DB) - ligne 16-25
const recentMessages = await prisma.message.findMany({
  where: {
    conversation: { contactId },
    sender: 'ai'
  },
  orderBy: { timestamp: 'desc' },
  take: 5
})
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- `styleRules`: RÃ¨gles de style depuis la DB
- Historique des 5 derniÃ¨res rÃ©ponses de l'AI (anti-rÃ©pÃ©tition)

**Exemple de output:**
```
[COMMENT PARLER]:
RÃˆGLES DE STYLE:
- Court (3-8 mots)
- Langage ado: "chui", "t'es", "genre"
- PAS de rÃ©pÃ©tition

ğŸš« PHRASES DÃ‰JÃ€ DITES:
- "ouais et toi"
- "jsuis en cours"
```

---

### 5ï¸âƒ£ AGENT "PHASE" (`phase-node.ts`)

**RÃ´le:** Savoir oÃ¹ en est la relation (CONNECTION â†’ MONEYPOT)

**Source des donnÃ©es:**
```typescript
// 1. AgentContact (DB) - ligne 11-20
const agentContact = await prisma.agentContact.findUnique({
  where: { agentId_contactId: { agentId, contactId } }
})
// RÃ©cupÃ¨re: phase ("CONNECTION"), signals (["RESPONSIVE"])

// 2. AgentProfile (DB) - ligne 22-30
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: {
    phaseConnectionTemplate: true,
    phaseVulnerabilityTemplate: true,
    phaseCrisisTemplate: true,
    phaseMoneypotTemplate: true
  }
})
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- `AgentContact.phase`: Phase actuelle
- `AgentContact.signals`: Signaux comportementaux
- Templates de phase depuis `AgentProfile`

**Exemple de output:**
```
[PHASE ACTUELLE: CRISIS]:
PHASE 3 : CRISE FINANCIÃˆRE
OBJECTIF: Tu es en galÃ¨re. Il VEUT t'aider.

Signaux dÃ©tectÃ©s: RÃ©actif, IntÃ©ressÃ©, Accro
Ã‰tat relation: En galÃ¨re mais il veut aider
```

---

### 6ï¸âƒ£ AGENT "MEMORY" (`memory-node.ts`)

**RÃ´le:** Rappeler les infos sur le contact

**Source des donnÃ©es:**
```typescript
// Mem0 (service existant) - ligne 10-18
const userId = memoryService.buildUserId(contactId, agentId)

// Recherche pertinente si query fournie
const searchResults = await memoryService.search(
  userId, 
  userMessage,  // Query = message actuel
  5             // Top 5 rÃ©sultats
)

// Ou rÃ©cupÃ©ration brute
const allMemories = await memoryService.getAll(userId)
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- Infos extraites par Mem0 sur ce contact
- Recherche sÃ©mantique basÃ©e sur la question

**Exemple de output:**
```
[INFOS SUR CETTE PERSONNE]:
- Il s'appelle Jean
- Il habite Paris
- Il travaille dans l'informatique
- Il aime le foot
```

---

### 7ï¸âƒ£ AGENT "PAYMENT" (`payment-node.ts`)

**RÃ´le:** GÃ©rer tout ce qui concerne l'argent

**Source des donnÃ©es:**
```typescript
// 1. AgentProfile (DB) - ligne 10-18
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { 
    paymentRules: true,
    bankAccountNumber: true,
    bankRoutingNumber: true
  }
})

// 2. AgentSettings (DB) - ligne 20
const settings = await settingsService.getAgentSettings(agentId)
// RÃ©cupÃ¨re: paypal, venmo, cashapp, etc.
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- `paymentRules`: RÃ¨gles de paiement
- MÃ©thodes activÃ©es (PayPal, Venmo, etc.)
- Identifiants de paiement
- CoordonnÃ©es bancaires (si activÃ©)

**Exemple de output:**
```
[PAIEMENT - RÃˆGLES STRICTES]:
Si on propose de payer â†’ ACCEPTE avec enthousiasme.
Attends confirmation avant [PAYMENT_RECEIVED].

MÃ‰THODES DISPONIBLES:
- PayPal: anais.du.94@gmail.com
- Bank: Account 647328586232728

FORMAT: Donne UNIQUEMENT le username quand on demande.
```

---

### 8ï¸âƒ£ AGENT "MEDIA" (`media-node.ts`)

**RÃ´le:** GÃ©rer les demandes de photos/vidÃ©os

**Source des donnÃ©es:**
```typescript
// AgentProfile (DB) - ligne 10-13
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { locale: true }
})

// Analyse locale du message (pas d'appel DB)
const msg = state.userMessage.toLowerCase()
// DÃ©tection: "selfie", "photo", "pieds", "chat", etc.
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- Locale (pour langue des rÃ¨gles)
- **Pas de DB** - analyse textuelle pure

**Exemple de output:**
```
[PHOTOS - RÃˆGLES ABSOLUES]:
- [IMAGE:xxx] UNIQUEMENT si on demande EXPLICITEMENT
- Photos dispo: selfie, face, pieds, chat, chien...
- INTERDICTION DE SUBSTITUTION

DEMANDE DÃ‰TECTÃ‰E: "selfie"
```

---

### 9ï¸âƒ£ AGENT "VOICE" (`voice-node.ts`)

**RÃ´le:** GÃ©rer les messages vocaux

**Source des donnÃ©es:**
```typescript
// 1. AgentProfile (DB) - ligne 10-13
const profile = await prisma.agentProfile.findUnique({
  where: { agentId },
  select: { locale: true }
})

// 2. AgentSettings (DB) - ligne 16
const settings = await settingsService.getAgentSettings(agentId)
const voiceEnabled = settings['voice_response_enabled'] === 'true'

// 3. State (paramÃ¨tre) - ligne 19-21
const isVoiceReceived = state.lastMessageType === 'voice'
const isAccused = msg.includes('fake') || msg.includes('bot')
```

**DonnÃ©es rÃ©cupÃ©rÃ©es:**
- `voice_response_enabled`: Setting activÃ© ou non
- Type du dernier message (voice/ptt)
- DÃ©tection accusation (fake/bot)

**Exemple de output:**
```
[VOCAUX - CAPACITÃ‰ ACTIVÃ‰E]:
- Tu PEUX envoyer des vocaux (tag [VOICE])
- OBLIGATOIRE si: 1) Il t'envoie un vocal
                 2) Il t'accuse de fake

SITUATION ACTUELLE:
- Il vient de t'envoyer un VOCAL â†’ TU DOIS RÃ‰PONDRE PAR VOCAL
```

---

### ğŸ”Ÿ AGENT "RESPONSE" (`response-node.ts`)

**RÃ´le:** Assembler tout et gÃ©nÃ©rer la rÃ©ponse finale

**Source des donnÃ©es:**
```typescript
// 1. Tous les contextes des agents prÃ©cÃ©dents (paramÃ¨tre state.contexts)
const contexts = {
  timing: "...",   // De timing-node
  persona: "...",  // De persona-node
  style: "...",    // De style-node
  phase: "...",    // De phase-node
  memory: "...",   // De memory-node (optionnel)
  payment: "...",  // De payment-node (optionnel)
  media: "...",    // De media-node (optionnel)
  voice: "..."     // De voice-node (optionnel)
}

// 2. Historique complet (paramÃ¨tre state.history)
const history: Message[]

// 3. Message actuel (paramÃ¨tre state.userMessage)
const userMessage: string

// 4. Venice (gÃ©nÃ©ration finale) - ligne 28-35
const response = await venice.chatCompletion(
  systemPrompt,  // Assemblage de tous les contexts
  history,
  userMessage,
  { model, temperature: 0.7, max_tokens: 500 }
)
```

---

## ğŸ“Š RÃ©capitulatif des Sources

| Agent | DB Primaire | Service Externe | DonnÃ©es clÃ©s |
|-------|-------------|-----------------|--------------|
| **Intention** | - | Venice LLM | Classification du message |
| **Timing** | `AgentProfile` | `personaSchedule` | Timezone, heure, activitÃ© |
| **Persona** | `AgentProfile` | - | Identity, context, mission |
| **Style** | `AgentProfile` + `Message` | - | RÃ¨gles + historique rÃ©ponses |
| **Phase** | `AgentContact` + `AgentProfile` | - | Phase, signals, templates |
| **Memory** | - | `memoryService` (Mem0) | Infos sur le contact |
| **Payment** | `AgentProfile` + `AgentSetting` | - | RÃ¨gles + mÃ©thodes de paiement |
| **Media** | `AgentProfile` (locale) | - | RÃ¨gles photos (analyse texte) |
| **Voice** | `AgentProfile` + `AgentSetting` | - | Setting vocal + dÃ©tection type |
| **Response** | - | `venice` | Assemblage + gÃ©nÃ©ration finale |

---

## ğŸ”„ Flux de donnÃ©es complet

```
Message utilisateur
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INTENTION   â”‚ â† Message + Historique (params)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PARALLEL FETCH                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TIMING    â”‚ DB: AgentProfile.timezone                 â”‚
â”‚            â”‚ Service: personaSchedule.getContextPrompt â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PERSONA   â”‚ DB: AgentProfile.identityTemplate         â”‚
â”‚            â”‚ DB: AgentProfile.contextTemplate          â”‚
â”‚            â”‚ DB: AgentProfile.missionTemplate          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  STYLE     â”‚ DB: AgentProfile.styleRules               â”‚
â”‚            â”‚ DB: Message (5 derniers)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PHASE     â”‚ DB: AgentContact.phase                    â”‚
â”‚            â”‚ DB: AgentContact.signals                  â”‚
â”‚            â”‚ DB: AgentProfile.phase*Template           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MEMORY    â”‚ Service: memoryService.search/getAll      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PAYMENT   â”‚ DB: AgentProfile.paymentRules             â”‚
â”‚            â”‚ DB: AgentSetting (paypal, venmo...)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MEDIA     â”‚ DB: AgentProfile.locale                   â”‚
â”‚            â”‚ Analyse: userMessage (texte)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VOICE     â”‚ DB: AgentSetting.voice_response_enabled   â”‚
â”‚            â”‚ Param: lastMessageType                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RESPONSE    â”‚ â† Assemble tous les contexts + Venice
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   RÃ©ponse finale
```

---

## âš¡ Optimisations

1. **ParallÃ©lisation:** Les agents TIMING, PERSONA, STYLE, PHASE, MEMORY s'exÃ©cutent en parallÃ¨le avec `Promise.all()`

2. **Lazy loading:** PAYMENT, MEDIA, VOICE ne s'exÃ©cutent que si nÃ©cessaire (selon l'intention dÃ©tectÃ©e)

3. **Caching:** Les settings sont rÃ©cupÃ©rÃ©s une fois et rÃ©utilisÃ©s

4. **Recherche sÃ©mantique:** Mem0 permet de trouver les memories pertinentes sans tout charger
